<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í‚¤ì›€ì¦ê¶Œ ì”ê³ ì¡°íšŒ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="p-5 bg-light">
    <div class="container">
        <h2 class="mb-4">ğŸ“Š ë‚´ ê³„ì¢Œ ì •ë³´</h2>
        <button class="btn btn-primary" onclick="fetchAccount()">ê³„ì¢Œ ì”ê³  ì¡°íšŒ</button>
        <div id="output" class="card p-3 mt-3 shadow-sm" style="display: none;"></div>
        <div id="output-available-cash" class="card p-3 mt-3 shadow-sm" style="display: none;"></div>
    </div>

    <script>
        function fetchAccount() {
            fetch("/api/account")
                .then(res => res.json())
                .then(data => {
                    const el = document.getElementById("output");
                    if (data.error) {
                        el.innerHTML = `<p class="text-danger">âŒ ${data.error}</p>`;
                    } else {
                        const totalInvestment = Number(data.total_investment.replace(/,/g, ""));
                        const totalValuation = Number(data.total_valuation.replace(/,/g, ""));
                        const profit = totalValuation - totalInvestment;

                        // ìˆ˜ìµ/ì†ì‹¤ ìŠ¤íƒ€ì¼ ë¶„ê¸°
                        const profitClass = profit >= 0 ? "text-danger" : "text-primary";
                        const profitText = profit >= 0 ? `${profit.toLocaleString()} ì›` : `${profit.toLocaleString()} ì›`;

                        // ìˆ˜ìµë¥  ê³„ì‚°
                        let profitRate = 0;
                        if (totalInvestment !== 0) {
                            profitRate = (profit / totalInvestment) * 100;
                        }
                        const profitRateText = `${profitRate.toFixed(2)}%`;

                        el.innerHTML = `
                        <ul class="list-group">
                            <li class="list-group-item"><strong>ì´ íˆ¬ìê¸ˆì•¡:</strong> ${totalInvestment.toLocaleString()} ì›</li>
                            <li class="list-group-item"><strong>ì´ í‰ê°€ê¸ˆì•¡:</strong> ${totalValuation.toLocaleString()} ì›</li>
                            <li class="list-group-item ${profitClass}">
                                <strong>ğŸ“ˆ ì†ìµ:</strong> <span>${profitText}</span>
                                <small class="ms-2">(${profitRateText})</small>
                            </li>
                        </ul>`;
                    }
                    el.style.display = "block";
                });

            fetch("/api/available_cash")
                .then(res => res.json())
                .then(data => {
                    const el = document.getElementById("output-available-cash");
                    if (data.error) {
                        el.innerHTML = `<p class="text-danger">âŒ ${data.error}</p>`;
                    } else {
                        el.innerHTML = `
                            <ul class="list-group">
                                <li class="list-group-item"><strong>ì£¼ë¬¸ê°€ëŠ¥ê¸ˆì•¡:</strong> ${data.available_cash} ì›</li>
                            </ul>`;
                    }
                    el.style.display = "block";
                });
        }

    </script>
</body>
</html>
