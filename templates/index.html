<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>키움증권 잔고조회</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="p-5 bg-light">
    <div class="container">
        <h2 class="mb-4">📊 내 계좌 정보</h2>
        <button class="btn btn-primary" onclick="fetchAccount()">계좌 잔고 조회</button>
        <div id="output" class="card p-3 mt-3 shadow-sm" style="display: none;"></div>
        <div id="output-available-cash" class="card p-3 mt-3 shadow-sm" style="display: none;"></div>
    </div>

    <script>
        function fetchAccount() {
            fetch("/api/account")
                .then(res => res.json())
                .then(data => {
                    const el = document.getElementById("output");
                    if (data.error) {
                        el.innerHTML = `<p class="text-danger">❌ ${data.error}</p>`;
                    } else {
                        const totalInvestment = Number(data.total_investment.replace(/,/g, ""));
                        const totalValuation = Number(data.total_valuation.replace(/,/g, ""));
                        const profit = totalValuation - totalInvestment;

                        // 수익/손실 스타일 분기
                        const profitClass = profit >= 0 ? "text-danger" : "text-primary";
                        const profitText = profit >= 0 ? `${profit.toLocaleString()} 원` : `${profit.toLocaleString()} 원`;

                        // 수익률 계산
                        let profitRate = 0;
                        if (totalInvestment !== 0) {
                            profitRate = (profit / totalInvestment) * 100;
                        }
                        const profitRateText = `${profitRate.toFixed(2)}%`;

                        el.innerHTML = `
                        <ul class="list-group">
                            <li class="list-group-item"><strong>총 투자금액:</strong> ${totalInvestment.toLocaleString()} 원</li>
                            <li class="list-group-item"><strong>총 평가금액:</strong> ${totalValuation.toLocaleString()} 원</li>
                            <li class="list-group-item ${profitClass}">
                                <strong>📈 손익:</strong> <span>${profitText}</span>
                                <small class="ms-2">(${profitRateText})</small>
                            </li>
                        </ul>`;
                    }
                    el.style.display = "block";
                });

            fetch("/api/available_cash")
                .then(res => res.json())
                .then(data => {
                    const el = document.getElementById("output-available-cash");
                    if (data.error) {
                        el.innerHTML = `<p class="text-danger">❌ ${data.error}</p>`;
                    } else {
                        el.innerHTML = `
                            <ul class="list-group">
                                <li class="list-group-item"><strong>주문가능금액:</strong> ${data.available_cash} 원</li>
                            </ul>`;
                    }
                    el.style.display = "block";
                });
        }

    </script>
</body>
</html>
